<a id="a<$= article.id $>"></a>
<div id="headerslider" class="flexslider" <$= system.partial("inline-editing-header.html") $>>
	<div class="flex-container">
		<ul class="slides">
		<$
		var numHeaders = article.value("header-count");

		for ( var i = 1; i <= numHeaders; ++i ) {
			var headerTitle = article.value("header-title-" + i, "");
			var headerDescription = article.value("header-description-" + i, "");

			var headerImage = article.value("header-image-" + i);
			var image = project.getImage(headerImage);
		 	$>
			
			<li>
				<$ if ( image ) { $>
					<img src="<$= image.workingCopyPath $>" alt="<$= system.removeHtmlTags(image.description) $>" />
				<$ } $>
				<$ if ( headerTitle || headerDescription ) { $>
					<div class="flex-caption">
						<$ if ( headerTitle ) { $>
							<$= system.partial("header-headline.html", i) $>
						<$ } $>
						<$= headerDescription $>
					</div>
				<$ } $>
			</li>

		<$ } $>

    </ul>
  </div>
</div>

<$
	var nextText = system.htmlEncode(page.attribute("header_next_text")) || "weiter";
	var prevText = system.htmlEncode(page.attribute("header_prev_text")) || "zurÃ¼ck";
	var inlineEditingInitDelay = 50;
	var useSmoothHeight = "#val(smootHeight)" === "false" ? "false" : "true";
	if ( useSmoothHeight === "true" ){
		inlineEditingInitDelay = 1000;
	}
$>

<$ if ( numHeaders > 0 ) { $>
	<script type="text/javascript">
		$z(document).ready(function() {
			// init flexslider after 1st image has loaded, so have dimensions as quickly as possible without having to wait too long on window loaded or such and can start right with doc ready
			$z('#headerslider .flex-container ul.slides li img').first().one("load", function(){
				$z('#headerslider .flex-container').flexslider({
					useCSS: true,
					touch: true,
					itemMargin: 20,
					animation: '<$= article.value("effect", "fade") $>',
					controlsContainer: '#headerslider.flexslider',
					slideshow: <$= article.value("autoplay") $>,
					slideshowSpeed: <$= article.value("duration", "5000") $>,
					<$ if ( "#val(header-navicons)" ) { $>directionNav: #val(header-navicons),<$ } $>
					<$ if ( "#val(header-pagination)" ) { $>controlNav: #val(header-pagination),<$ } $>
					<$ if ( "#val(header-randomize)" ) { $>randomize: #val(header-randomize),<$ } $>
					<$ if ( system.preview ){ $>start: function(){ setTimeout(zpieInit,<$= inlineEditingInitDelay $>); },<$ } $>
					pauseOnHover: true,
					smoothHeight: <$= useSmoothHeight $>,
					prevText: "<$= prevText $>",
					nextText: "<$= nextText $>"
				});

			}).each(function() {
				if(this.complete) $z(this).load();
			}); // .each() is to work around a browser bugs which don't fire load() for cached images http://stackoverflow.com/a/3877079
		});
  	</script>
<$ } $>
